<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.css">
    <link rel="stylesheet" href="../css/chat/chat.css" />
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<img id="logo-image" src="../images/logo.png" width="100" height="80" >
<div class="main-section">
    <div class="head-section">
        <div class="headLeft-section">
            <div class="headLeft-sub">
                <input type="text" name="search" placeholder="Search...">
                <button><i class="fa fa-search"></i></button>
            </div>
        </div>
        <div class="headRight-section">
            <div class="headRight-sub">
                <h3>Lajy Ion</h3>
                <small>Lorem ipsum dolor sit amet...</small>
            </div>
        </div>
    </div>
    <div class="body-section">
        <div class="left-section mCustomScrollbar" data-mcs-theme="minimal-dark">
            <ul class="lawyer-message-area">
                <li>
                    <div class="chatList">
                        <div class="img">
                            <i class="fa fa-circle"></i>
                            <img src="../images/man.png">
                        </div>
                        <div class="desc">
                            <small class="time">05:30 am</small>
                            <h5>Luis Yankee</h5>
                            <small>Lorem ipsum dolor sit amet...</small>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="chatList">
                        <div class="img">
                            <i class="fa fa-circle"></i>
                            <img src="../images/man.png">
                        </div>
                        <div class="desc">
                            <small class="time">3 day</small>
                            <h5>Joi Chak</h5>
                            <small>Lorem ipsum dolor sit amet...</small>
                        </div>
                    </div>
                </li>
                <li class="active">
                    <div class="chatList">
                        <div class="img">
                            <img src="../images/man.png">
                        </div>
                        <div class="desc">
                            <small class="time">4 day</small>
                            <h5>Lajy Ion</h5>
                            <small>Lorem ipsum dolor sit amet...</small>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="chatList">
                        <div class="img">
                            <img src="../images/man.png">
                        </div>
                        <div class="desc">
                            <small class="time">18 day</small>
                            <h5>Lod Kine</h5>
                            <small>Lorem ipsum dolor sit amet...</small>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="chatList">
                        <div class="img">
                            <i class="fa fa-circle"></i>
                            <img src="../images/man.png">
                        </div>
                        <div class="desc">
                            <small class="time">11:50 am</small>
                            <h5>Nik Minaj</h5>
                            <small>Lorem ipsum dolor sit amet...</small>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="chatList">
                        <div class="img">
                            <img src="../images/man.png">
                        </div>
                        <div class="desc">
                            <small class="time">20 day</small>
                            <h5>Win Sina</h5>
                            <small>Lorem ipsum dolor sit amet...</small>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="chatList">
                        <div class="img">
                            <img src="../images/man.png">
                        </div>
                        <div class="desc">
                            <small class="time">18 day</small>
                            <h5>Jack Clerk</h5>
                            <small>Lorem ipsum dolor sit amet...</small>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="chatList">
                        <div class="img">
                            <img src="../images/man.png">
                        </div>
                        <div class="desc">
                            <small class="time">20 day</small>
                            <h5>Win Sina</h5>
                            <small>Lorem ipsum dolor sit amet...</small>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="chatList">
                        <div class="img">
                            <img src="../images/man.png">
                        </div>
                        <div class="desc">
                            <small class="time">18 day</small>
                            <h5>Jack Clerk</h5>
                            <small>Lorem ipsum dolor sit amet...</small>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
        <div class="right-section">
            <div class="message mCustomScrollbar" data-mcs-theme="minimal-dark">
                <ul class="client-message-area">
                    <li class="msg-left">
                        <div class="msg-left-sub">
                            <img src="../images/man.png">
                            <div class="msg-desc">
                                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                                tempor incididunt ut labore et dolore magna aliqua.
                            </div>
                            <small>05:25 am</small>
                        </div>
                    </li>
                    <li class="msg-right">
                        <div class="msg-left-sub">
                            <img src="../images/man.png">
                            <div class="msg-desc">
                                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                                tempor incididunt ut labore et dolore magna aliqua.
                            </div>
                            <small>05:25 am</small>
                        </div>
                    </li>
                    <li class="msg-day"><small>Wednesday</small></li>
                    <li class="msg-left">
                        <div class="msg-left-sub">
                            <img src="../images/man.png">
                            <div class="msg-desc">
                                Lorem ipsum dolor sit amet, consectetur adipisicing elit
                            </div>
                            <small>05:25 am</small>
                        </div>
                    </li>
                    <li class="msg-right">
                        <div class="msg-left-sub">
                            <img src="../images/man.png">
                            <div class="msg-desc">
                                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                                tempor incididunt ut labore et dolore magna aliqua.
                            </div>
                            <small>05:25 am</small>
                        </div>
                    </li>
                    <li class="msg-left">
                        <div class="msg-left-sub">
                            <img src="../images/man.png">
                            <div class="msg-desc">
                                Lorem ipsum dolor sit amet, consectetur adipisicing elit
                            </div>
                            <small>05:25 am</small>
                        </div>
                    </li>
                    <li class="msg-right">
                        <div class="msg-left-sub">
                            <img src="../images/man.png">
                            <div class="msg-desc">
                                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                                tempor incididunt ut labore et dolore magna aliqua.
                            </div>
                            <small>05:25 am</small>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="right-section-bottom">
                <form>
                    <div class="upload-btn">
                        <button class="btn"><i class="fa fa-photo"></i></button>
                        <input type="file"/>
                    </div>
                    <input type="text" name="" placeholder="type here..." class="message-input">
                    <button class="btn-send"><i class="fa fa-send"></i></button>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<!-- custom scrollbar plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.4.0/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

<!--<script src="/js/main.js"></script>-->
<script th:inline="javascript">
    'use strict';
    var dto=[[${dto}]];
    //var message=[[${message}]];


    var lawyerMessageArea=document.querySelector('.lawyer-message-area');
    var clientMessageArea=document.querySelector('.client-message-area')
    var messageInput = document.querySelector('.btn-send');
    var messageInputValue=document.querySelector('.message-input');
    // console.log(dto);
    // if(dto.hasOwnProperty('clientId')){
    //     console.log("hello client");
    // }
    // if(dto.hasOwnProperty('lawyerId')){
    //     console.log("hello lawyer");
    //
    // }
    var usernamePage = document.querySelector('#username-page');
    var chatPage = document.querySelector('#chat-page');
    var usernameForm = document.querySelector('#usernameForm');
    var messageForm = document.querySelector('#messageForm');

    var messageArea = document.querySelector('#messageArea');
    var connectingElement = document.querySelector('.connecting');

    var stompClient = null;
    var username = null;

    var colors = [
        '#2196F3', '#32c787', '#00BCD4', '#ff5652',
        '#ffc107', '#ff85af', '#FF9800', '#39bbb0'
    ];
    connect();

    function connect(event) {
        // username = document.querySelector('#name').value.trim();
        //
        // if(username) {
           // usernamePage.classList.add('hidden');
           // chatPage.classList.remove('hidden');

            var socket = new SockJS('/ws');
            stompClient = Stomp.over(socket);

            stompClient.connect({}, onConnected, onError);
      //  }
       // event.preventDefault();
    }


    function onConnected() {
        // Subscribe to the Public Topic
        stompClient.subscribe('/topic/public', onMessageReceived);

        // Tell your username to the server
        stompClient.send("/app/chat.addUser",
            {},
            JSON.stringify({sender: username, type: 'JOIN'})
        )

       // connectingElement.classList.add('hidden');
    }


    function onError(error) {
       // connectingElement.textContent = 'Could not connect to WebSocket server. Please refresh this page to try again!';
       // connectingElement.style.color = 'red';
    }


    function sendMessage(event) {
        console.log("sendMessage clicked");
        var messageContent = messageInputValue.value.trim();
        console.log("message 내용:"+messageContent);
        console.log(stompClient);
        if(messageContent && stompClient) {
            var chatMessage = {
                sender: "client",
                content: messageInputValue.value,
            };
            stompClient.send("/app/chat.sendMessage", {}, JSON.stringify(chatMessage));
            messageInputValue.value = '';
        }
        event.preventDefault();
    }


    function onMessageReceived(payload) {
        var message = JSON.parse(payload.body);
        console.log("message Received!!! from controller");

        var liElement=document.createElement('li');

        if(dto.hasOwnProperty("clientId")){
            liElement.classList.add('msg-right');
        }else{
            liElement.classList.add('msg-left');
        }

        var msgLeftSubDivElement=document.createElement('div');
        msgLeftSubDivElement.classList.add('msg-left-sub');
        liElement.appendChild(msgLeftSubDivElement);

        var imgElement=document.createElement('img');
        imgElement.src='../images/man.png';
        imgElement.classList.add('mCS_img_loaded');
        var msgDescElement=document.createElement('div');
        msgDescElement.classList.add('msg-desc');
        var msgDescTextNode=document.createTextNode(message.content);
        msgDescElement.appendChild(msgDescTextNode);

        var smallElement=document.createElement('small');
        var smallTextNoe=document.createTextNode(message.date);
        smallElement.appendChild(smallTextNoe);

        msgLeftSubDivElement.appendChild(imgElement);
        msgLeftSubDivElement.appendChild(msgDescElement);
        msgLeftSubDivElement.appendChild(smallElement);

        if(dto.hasOwnProperty("clientId")){
            clientMessageArea.appendChild(liElement);
            clientMessageArea.scrollTop=clientMessageArea.scrollHeight;
        }else{
            lawyerMessageArea.appendChild(liElement);
            lawyerMessageArea.scrollTop=lawyerMessageArea.scrollHeight;
        }
















        // var messageElement = document.createElement('li');
        //
        // var chatListElement=document.createElement('div');
        // chatListElement.classList.add('chatList');
        // var imgElement=document.createElement('div');
        // imgElement.classList.add('img');
        // chatListElement.appendChild(imgElement);
        //
        // var iElement=document.createElement('i');
        // iElement.classList.add(".fa.fa-circle");
        // var imageElement=document.createElement('img');
        // imageElement.src="../images/man.png";
        // imgElement.appendChild(iElement);
        // imgElement.appendChild(imageElement);
        //
        // var descElement=document.createElement('div');
        // descElement.classList.add("desc");
        //
        // var smallTimeElement=document.createElement('small');
        // smallTimeElement.classList.add('time');
        // var smallTimeText=document.createTextNode(message.date);
        // smallTimeElement.appendChild(smallTimeText);
        // smallTimeElement.classList.add("time");
        //
        // var h5Element=document.createElement('h5');
        // var h5Text=document.createTextNode(message.sender);
        // h5Element.appendChild(h5Text);
        // var smallElement=document.createElement('small');
        // var smallText=document.createTextNode(message.content);
        // smallTimeElement.appendChild(smallText);
        //
        // descElement.appendChild(smallTimeElement);
        // descElement.appendChild(h5Element);
        // descElement.appendChild(smallElement);
        //
        // chatListElement.appendChild(descElement);
        //
        // messageElement.appendChild(chatListElement);
        //
        // if(dto.hasOwnProperty("clientId")){
        //     clientMessageArea.appendChild(chatListElement);
        //     clientMessageArea.scrollTop=clientMessageArea.scrollHeight;
        // }else{
        //     lawyerMessageArea.appendChild(chatListElement);
        //     lawyerMessageArea.scrollTop=lawyerMessageArea.scrollHeight;
        // }
        // console.log(clientMessageArea);




    }


    function getAvatarColor(messageSender) {
        var hash = 0;
        for (var i = 0; i < messageSender.length; i++) {
            hash = 31 * hash + messageSender.charCodeAt(i);
        }
        var index = Math.abs(hash % colors.length);
        return colors[index];
    }

    //usernameForm.addEventListener('submit', connect, true)
    messageInput.addEventListener('click', sendMessage, true)
</script>
</body>
</html>